var FadedMultiselect=function(a,b){var c,d,e=$(a).first(),f={buttonSelect:"Select",selected:"selected",noneSelected:"None selected",allSelected:"All selected"},g="<div class='faded-multiselect'>  <button class='faded-multiselect-button'>    <span class='faded-multiselect-button-text'>      "+f.buttonSelect+"    </span>    <div class='caret'>&#9662;</div>  </button>  <div class='faded-multiselect-dropdown'></div>  <div class='original-multiselect'></div></div>",h="<div class='faded-multiselect-dropdown-option'>  <input type='checkbox'>  <span>OptionX</span></div>",i=function(){c=$(g),e=e.replaceWith(c),c.find(".original-multiselect").append(e),j(),m()},j=function(){b.maxDropdownHeight&&d&&d.destroy(),q(),r(),s(),b.maxDropdownHeight&&(c.find(".faded-multiselect-dropdown").height(b.maxDropdownHeight),d=new FadedScrollbar(c.find(".faded-multiselect-dropdown"))),c.find(".faded-multiselect-button").bind("mousedown",w),c.find(".faded-multiselect-dropdown-option").bind("click",x),B()},k=function(){q(),d&&d.destroy(),c.replaceWith(e)},l=function(){return e.val()},m=function(){$("html").bind("mousedown",function(a){a.stopPropagation(),n()})},n=function(){c.removeClass("open")},o=function(){c.addClass("open"),d&&d.refresh()},p=function(){c.find(".faded-multiselect-button").unbind("mousedown"),c.find(".faded-multiselect-dropdown-option").unbind("click")},q=function(){p(),c.find(".faded-multiselect-dropdown-option").remove()},r=function(){if(b.allOption){var a=$(h);a.find("span").html("All"),a.attr("data-value",""),a.attr("data-special","all"),c.find(".faded-multiselect-dropdown").append(a)}},s=function(){$.each(e.find("option"),function(a,b){var d=$(b),e=$(h);e.find("span").html(d.html()),e.attr("data-value",d.val()),c.find(".faded-multiselect-dropdown").append(e)}),t(),u()},t=function(){$.each(e.find("option"),function(a,b){var d=$(b),e=d[0].selected,f=$(b).attr("value"),g=c.find(".faded-multiselect-dropdown").find("[data-value="+f+"]"),h=g.find("input[type=checkbox]");h.attr("checked",e)})},u=function(){if(b.allOption){var a=z();l().length===e.find("option").length?a.attr("checked",!0):l().length||a.attr("checked",!1)}},v=function(a){var c=$(a).attr("data-special"),d="all"===c;if(d)A();else{var f=$(a).attr("data-value"),g=e.find("option[value="+f+"]")[0];g.selected=!g.selected}b.onStateChange&&b.onStateChange(l(),c||f)},w=function(a){a.stopPropagation(),c.hasClass("open")?n():o()},x=function(a){a.stopPropagation();var b=$(this).find("input[type=checkbox]");b.attr("checked",!b.attr("checked")),v($(this)),B(),y()},y=function(){var a=l().length,b=e.find("option").length;z().attr("checked",a===b)},z=function(){return c.find("[data-special=all] input[type=checkbox]")},A=function(){var a=l().length!==e.find("option").length;$.each(e.find("option"),function(b,c){$(c)[0].selected=a}),j()},B=function(){var a,d,g=l().length,h=c.find(".faded-multiselect-button-text");b.buttonText?d=b.buttonText(l()):g?g===e.find("option").length?d=f.allSelected:1===g?(a=e.find("option[value="+l()[0]+"]").text(),d=a):d=g+" "+f.selected:d=f.noneSelected,h.text(d)};return b=b||{},i(),{init:i,refresh:j,destroy:k,getValue:l}};