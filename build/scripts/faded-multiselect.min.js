var FadedMultiselect=function(a,b){var c,d=$(a).first(),e={buttonSelect:"Select",selected:"selected",noneSelected:"None selected",allSelected:"All selected"},f="<div class='faded-multiselect'>  <button class='faded-multiselect-button'>    <span class='faded-multiselect-button-text'>      "+e.buttonSelect+"    </span>    <div class='caret'>&#9662;</div>  </button>  <div class='faded-multiselect-dropdown'></div>  <div class='original-multiselect'></div></div>",g="<div class='faded-multiselect-dropdown-option'>  <input type='checkbox'>  <span>OptionX</span></div>",h=function(){c=$(f),d=d.replaceWith(c),c.find(".original-multiselect").append(d),i(),l()},i=function(){m(),n(),o(),p(),c.find(".faded-multiselect-button").bind("click",t),c.find(".faded-multiselect-dropdown-option").bind("click",u),y()},j=function(){c.replaceWith(d)},k=function(){return d.val()},l=function(){$("html").bind("click",function(){c.removeClass("open")})},m=function(){c.find(".faded-multiselect-button").unbind("click"),c.find(".faded-multiselect-dropdown-option").unbind("click")},n=function(){c.find(".faded-multiselect-dropdown").html("")},o=function(){if(b.allOption){var a=$(g);a.find("span").html("All"),a.attr("data-value",""),a.attr("data-special","all"),c.find(".faded-multiselect-dropdown").append(a)}},p=function(){$.each(d.find("option"),function(a,b){var d=$(b),e=$(g);e.find("span").html(d.html()),e.attr("data-value",d.val()),c.find(".faded-multiselect-dropdown").append(e)}),q(),r()},q=function(){$.each(d.find("option"),function(a,b){var d=$(b),e=d[0].selected,f=$(b).attr("value"),g=c.find(".faded-multiselect-dropdown").find("[data-value="+f+"]"),h=g.find("input[type=checkbox]");h.attr("checked",e)})},r=function(){if(b.allOption){var a=w();k().length===d.find("option").length?a.attr("checked",!0):k().length||a.attr("checked",!1)}},s=function(a){var c=$(a).attr("data-special"),e="all"===c;if(e)x();else{var f=$(a).attr("data-value"),g=d.find("option[value="+f+"]")[0];g.selected=!g.selected}b.onStateChange&&b.onStateChange(k(),c||f)},t=function(a){a.stopPropagation(),$(this).closest(".faded-multiselect").toggleClass("open")},u=function(a){a.stopPropagation();var b=$(this).find("input[type=checkbox]");b.attr("checked",!b.attr("checked")),s($(this)),y(),v()},v=function(){var a=k().length,b=d.find("option").length;w().attr("checked",a===b)},w=function(){return c.find("[data-special=all] input[type=checkbox]")},x=function(){var a=k().length!==d.find("option").length;$.each(d.find("option"),function(b,c){$(c)[0].selected=a}),i()},y=function(){var a,f,g=k().length,h=c.find(".faded-multiselect-button-text");b.buttonText?f=b.buttonText(k()):g?g===d.find("option").length?f=e.allSelected:1===g?(a=d.find("option[value="+k()[0]+"]").text(),f=a):f=g+" "+e.selected:f=e.noneSelected,h.text(f)};return b=b||{},h(),{init:h,refresh:i,destroy:j,getValue:k}};