var FadedMultiselect=function(t,e){var n,d,i=$(t).first(),o={buttonSelect:"Select",selected:"selected",noneSelected:"None selected",allSelected:"All selected"},a="<div class='faded-multiselect'>  <button class='faded-multiselect-button'>    <span class='faded-multiselect-button-text'>      "+o.buttonSelect+"    </span>    <div class='caret'>&#9662;</div>  </button>  <div class='faded-multiselect-dropdown'></div>  <div class='original-multiselect'></div></div>",l="<div class='faded-multiselect-dropdown-option'>  <input type='checkbox'>  <span>OptionX</span></div>",c=function(){n=$(a),i=i.replaceWith(n),n.find(".original-multiselect").append(i),u(),s()},u=function(){e.maxDropdownHeight&&d&&d.destroy(),v(),m(),b(),e.maxDropdownHeight&&(n.find(".faded-multiselect-dropdown").height(e.maxDropdownHeight),d=new FadedScrollbar(n.find(".faded-multiselect-dropdown"))),n.find(".faded-multiselect-button").bind("mousedown",k),n.find(".faded-multiselect-dropdown-option").bind("click",S),H()},f=function(){return i.val()},s=function(){$("html").bind("mousedown",function(t){t.stopPropagation(),p()})},p=function(){n.removeClass("open")},r=function(){n.addClass("open"),d&&d.refresh()},h=function(){n.find(".faded-multiselect-button").unbind("mousedown"),n.find(".faded-multiselect-dropdown-option").unbind("click")},v=function(){h(),n.find(".faded-multiselect-dropdown-option").remove()},m=function(){if(e.allOption){var t=$(l);t.find("span").html("All"),t.attr("data-value",""),t.attr("data-special","all"),n.find(".faded-multiselect-dropdown").append(t)}},b=function(){$.each(i.find("option"),function(t,e){var d=$(e),i=$(l);i.find("span").html(d.html()),i.attr("data-value",d.val()),n.find(".faded-multiselect-dropdown").append(i)}),g(),w()},g=function(){$.each(i.find("option"),function(t,e){var d=$(e)[0].selected,i=$(e).attr("value");n.find(".faded-multiselect-dropdown").find("[data-value="+i+"]").find("input[type=checkbox]").attr("checked",d)})},w=function(){if(e.allOption){var t=C();f().length===i.find("option").length?t.attr("checked",!0):f().length||t.attr("checked",!1)}},x=function(t){var n=$(t).attr("data-special");if("all"===n)D();else{var d=$(t).attr("data-value"),o=i.find("option[value="+d+"]")[0];o.selected=!o.selected}e.onStateChange&&e.onStateChange(f(),n||d)},k=function(t){t.stopPropagation(),n.hasClass("open")?p():r()},S=function(t){t.stopPropagation();var e=$(this).find("input[type=checkbox]");e.attr("checked",!e.attr("checked")),x($(this)),H(),y()},y=function(){var t=f().length,e=i.find("option").length;C().attr("checked",t===e)},C=function(){return n.find("[data-special=all] input[type=checkbox]")},D=function(){var t=f().length!==i.find("option").length;$.each(i.find("option"),function(e,n){$(n)[0].selected=t}),u()},H=function(){var t,d=f().length,a=n.find(".faded-multiselect-button-text");t=e.buttonText?e.buttonText(f()):d?d===i.find("option").length?o.allSelected:1===d?i.find("option[value="+f()[0]+"]").text():d+" "+o.selected:o.noneSelected,a.text(t)};return e=e||{},c(),{init:c,refresh:u,destroy:function(){v(),d&&d.destroy(),n.replaceWith(i)},getValue:f}};